<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>logic-analyzer: Arduino Logic Analyzer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">logic-analyzer
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Arduino Logic Analyzer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Recently, when I started to research the topic of <a href="https://en.wikipedia.org/wiki/Logic_analyzer">Logic Analyzers</a>, I found the incredible <a href="https://sigrok.org/wiki/PulseView">PulseView Project</a>. However, I did not want to invest in additional hardware but just use one of my favorite microprocessors (ESP32, Raspberry Pico) as capturing device.</p>
<p>There are quite a few logic analyzer projects with a similar goal:</p>
<ul>
<li><a href="https://github.com/gillham/logic_analyzer">https://github.com/gillham/logic_analyzer</a></li>
<li><a href="https://github.com/gamblor21/rp2040-logic-analyzer/">https://github.com/gamblor21/rp2040-logic-analyzer/</a></li>
<li><a href="https://github.com/EUA/ESP32_LogicAnalyzer">https://github.com/EUA/ESP32_LogicAnalyzer</a></li>
<li><a href="https://github.com/Ebiroll/esp32_sigrok">https://github.com/Ebiroll/esp32_sigrok</a></li>
</ul>
<p>Howerver all of them are geared for <b>one specific architecture</b> and therfore are <b>not portable</b>.</p>
<p>I wanted to come up with a better design and provide a <a href="https://pschatzmann.github.io/logic-analyzer/html/annotated.html">basic C++ API</a> that clearly separates the generic functionality from the processor specific in order to support an easy rollout to new architectures: The only common precondition is the Arduino API.</p>
<p>To come up with an optimized implementation for a specific board you just need to implement a specifig <a class="el" href="config_8h_source.html">config.h</a> and optionally you can also subclass LogicAnalyzer and overwirte e.g. your custom capture method...</p>
<h1><a class="anchor" id="autotoc_md1"></a>
The Arduino Sketch</h1>
<p>The basic Arduino Sketch for a logic-analyzer is quite simple. We basically just need to call begin on a LogicAnalyzer object and add the command handler in the loop():</p>
<div class="fragment"><div class="line">#include &quot;Arduino.h&quot;</div>
<div class="line">#include &quot;logic_analyzer.h&quot;</div>
<div class="line"> </div>
<div class="line">using namespace logic_analyzer;  </div>
<div class="line"> </div>
<div class="line">LogicAnalyzer&lt;PinBitArray&gt; logicAnalyzer;</div>
<div class="line">int pinStart=4;</div>
<div class="line">int numberOfPins=8;</div>
<div class="line"> </div>
<div class="line">void setup() {</div>
<div class="line">    setupLogger(); // as defined in processor specific config</div>
<div class="line">    Serial.begin(SERIAL_SPEED);  </div>
<div class="line">    Serial.setTimeout(SERIAL_TIMEOUT);</div>
<div class="line">    logicAnalyzer.begin(Serial, new PinReader(pinStart), MAX_FREQ,  MAX_CAPTURE_SIZE, pinStart, numberOfPins);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">void loop() {</div>
<div class="line">    logicAnalyzer.processCommand();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Connecting to Pulseview</h1>
<ul>
<li>Start the Arduino __"logic-analyzer"__ Sketch</li>
<li>Start <b>Pulseview</b></li>
<li>Select "Connect to a Device":<ul>
<li>Choose the Driver: <b>Openbentch Logic Sniffer &amp; SUMP Compatibles</b></li>
<li>Choose the Interface: Select <b>Serial Port</b> with the Port to your Arduino Device and the frequency defined in the config&lt;Device&gt;.h (e.g. the ESP32 uses 921600)</li>
<li>Click on __"Scan for Devices using driver above"__ button</li>
<li>Select the Device - __"Arduino"__ which should be available and confirm with OK</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Supported Archtectures</h1>
<p>I have tested the functionality with the following processors:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Processor   </th><th class="markdownTableHeadNone">Max Freq   </th><th class="markdownTableHeadNone">Max Samples   </th><th class="markdownTableHeadNone">Pins    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">ESP32   </td><td class="markdownTableBodyNone">2463700   </td><td class="markdownTableBodyNone">100000   </td><td class="markdownTableBodyNone">8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ESP8266   </td><td class="markdownTableBodyNone">1038680   </td><td class="markdownTableBodyNone">50000   </td><td class="markdownTableBodyNone">4    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">AVR Processors (Nano)   </td><td class="markdownTableBodyNone">109170   </td><td class="markdownTableBodyNone">500   </td><td class="markdownTableBodyNone">8    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Raspberry Pico   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
</table>
<h1><a class="anchor" id="autotoc_md4"></a>
Limitations / Potential Improvements</h1>
<p>The baisc implementation is using a single core. While capturing is in process we do not support any cancellation triggered from Pulseview. In order to support this we would need to extend the functionality to run the capturing on one core and the command handling on the second core. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
